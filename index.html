<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GAS Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { 
                extend: { 
                    colors: { slate: { 950: '#0f172a' } },
                    spacing: { 'safe-b': 'env(safe-area-inset-bottom)' }
                } 
            }
        }
    </script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        .loader { border: 3px solid rgba(128,128,128,0.3); border-radius: 50%; border-top: 3px solid #3b82f6; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        textarea, input { font-size: 14px !important; }
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 200; white-space: nowrap; }
        .toast.show { opacity: 1; }
        .modal-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
        html.dark .modal-bg { background: rgba(0,0,0,0.8); }
    </style>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50 text-slate-900 dark:bg-slate-950 dark:text-gray-100 transition-colors duration-200">
    <div id="root"></div>
    <div id="toast" class="toast">Message</div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from "https://esm.sh/react@18.2.0";
        import { createRoot } from "https://esm.sh/react-dom@18.2.0/client";

        // --- CONFIG ---
        // PASTE YOUR WEB APP URL HERE:
        const API_URL = "https://script.google.com/macros/s/AKfycbx6Iv9HjZl-b_ZXpRhSG4Yjg1Hv7nGWo7V6UEtThVL-TIkR2BC2JB3q04tHHPAvFpNN/exec";

        // --- ICONS ---
        const Icons = {
            Script: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5 text-blue-500"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>,
            Sheet: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5 text-emerald-500"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>,
            Doc: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5 text-sky-500"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
            Form: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5 text-purple-500"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-4 h-4"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Zap: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Globe: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-4 h-4"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
            Back: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Menu: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-5 h-5"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>,
            Paste: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>,
            Copy: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Save: () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        };

        function App() {
            const [theme, setTheme] = useState(localStorage.getItem("theme") || "dark");
            useEffect(() => { document.documentElement.classList.toggle('dark', theme === 'dark'); localStorage.setItem("theme", theme); }, [theme]);
            const toggleTheme = () => setTheme(t => t === 'dark' ? 'light' : 'dark');

            const [apiKey, setApiKey] = useState(localStorage.getItem("gas_key") || "");
            const [view, setView] = useState(apiKey ? "dashboard" : "login");
            const [loading, setLoading] = useState(false);
            
            const [projects, setProjects] = useState([]);
            const [filter, setFilter] = useState("script");
            
            // Editor State
            const [editor, setEditor] = useState({ id: null, name: "", files: [], activeIdx: 0, isDirty: false });
            const [deployDesc, setDeployDesc] = useState("Update"); 
            
            const [modal, setModal] = useState(null);
            const [toastMsg, setToastMsg] = useState(null);

            const toast = (msg) => { setToastMsg(msg); setTimeout(() => setToastMsg(null), 3000); }

            const api = async (action, payload = {}) => {
                payload.action = action;
                payload.password = apiKey;
                const res = await fetch(API_URL, { method: "POST", body: JSON.stringify(payload) });
                const json = await res.json();
                if(json.status === 'error') throw new Error(json.message);
                return json.data;
            };

            const loadProjects = async () => {
                setLoading(true);
                try {
                    const list = await api("getProjects", { type: filter });
                    setProjects(list);
                } catch(e) { toast("Error: " + e.message); }
                setLoading(false);
            };

            useEffect(() => { if(view === "dashboard") loadProjects(); }, [filter, view]);

            const handleLogin = () => {
                if(!apiKey) return;
                localStorage.setItem("gas_key", apiKey);
                setView("dashboard");
            };

            const openProject = async (project) => {
                if (!project.mime.includes('script') && !project.linkedScriptId) {
                    setModal({ type: 'link', data: { containerId: project.id } });
                    return;
                }
                const targetId = project.linkedScriptId || project.id;
                setLoading(true);
                try {
                    const files = await api("getContent", { id: targetId });
                    setEditor({ id: targetId, name: project.name, files: files, activeIdx: 0, isDirty: false });
                    setDeployDesc("Update");
                    setView("editor");
                } catch(e) { toast(e.message); }
                setLoading(false);
            };

            const handleLaunch = async (p, e) => {
                e.stopPropagation();
                // NO CONFIRMATION - JUST LAUNCH
                const win = window.open("about:blank", "_blank");
                if (!win) {
                    toast("Popup blocked! Allow popups for this site.");
                    return;
                }
                
                win.document.write(`<html><body style="background:#0f172a;color:white;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-family:sans-serif;margin:0;"><div style="border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top: 3px solid #3b82f6; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 20px;"></div><div>Launching Web App...</div><style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style></body></html>`);

                const targetId = p.linkedScriptId || p.id;
                
                try {
                    const url = await api("getAppUrl", { id: targetId });
                    if(url) win.location.href = url;
                    else throw new Error("No URL returned");
                } catch(e) { 
                    win.close(); 
                    toast(e.message.includes("No deployments") ? "Project not deployed yet." : "Launch Failed: " + e.message); 
                }
            };

            const handleDelete = async (p, e) => {
                e.stopPropagation();
                if(!confirm(p.linkedScriptId ? "Unlink script?" : "Trash project?")) return;
                setLoading(true);
                try {
                    if(p.linkedScriptId) await api("unlinkScript", { containerId: p.id });
                    else await api("deleteProject", { id: p.id });
                    loadProjects();
                    toast("Done");
                } catch(e) { toast(e.message); }
                setLoading(false);
            };

            // --- FILE DELETION ---
            const handleFileDelete = (e, index) => {
                e.stopPropagation(); // Stop switching tabs
                if (editor.files.length <= 1) {
                    toast("Cannot delete the only file.");
                    return;
                }
                if (!confirm(`Delete file "${editor.files[index].name}"?`)) return;
                
                const newFiles = editor.files.filter((_, i) => i !== index);
                // Adjust activeIdx if needed
                let newIdx = editor.activeIdx;
                if (index === editor.activeIdx) {
                    newIdx = Math.max(0, index - 1);
                } else if (index < editor.activeIdx) {
                    newIdx = editor.activeIdx - 1;
                }
                
                setEditor({ ...editor, files: newFiles, activeIdx: newIdx, isDirty: true });
                toast("File deleted. Save to persist.");
            };

            const executeDeploy = async (isNew, access, desc) => {
                setModal(null); setLoading(true);
                try {
                    const res = await api("deploy", { id: editor.id, isNew, access, desc });
                    window.open(res.url, '_blank');
                    toast("Deployed v" + res.version);
                } catch(e) { toast("Deploy Error: " + e.message); }
                setLoading(false);
            };

            const saveFile = async () => {
                setLoading(true);
                try {
                    await api("saveContent", { id: editor.id, files: editor.files });
                    setEditor(p => ({ ...p, isDirty: false }));
                    toast("Saved");
                } catch(e) { toast(e.message); }
                setLoading(false);
            };
            
            const handleCopy = () => {
                const text = editor.files[editor.activeIdx]?.source || "";
                navigator.clipboard.writeText(text).then(() => toast("Copied")).catch(() => toast("Copy Failed"));
            };

            const handlePaste = async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    if(text) {
                        const newFiles = [...editor.files];
                        newFiles[editor.activeIdx].source = text;
                        setEditor({ ...editor, files: newFiles, isDirty: true });
                        toast("Pasted");
                    }
                } catch (err) { 
                    setModal({ type: 'pasteManual' });
                }
            };

            const FilterChip = ({ label, id }) => (
                <button onClick={() => setFilter(id)} className={`px-4 py-1.5 rounded-full text-sm font-medium transition whitespace-nowrap border ${filter === id ? 'bg-blue-600 border-blue-600 text-white' : 'bg-white dark:bg-slate-800 border-gray-200 dark:border-slate-700 text-gray-500'}`}>
                    {label}
                </button>
            );

            return (
                <div className="max-w-2xl mx-auto h-[100dvh] flex flex-col relative text-slate-900 dark:text-gray-100">
                    
                    {/* Header */}
                    {view !== "login" && (
                        <div className="sticky top-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur border-b border-gray-200 dark:border-slate-800 p-3 flex items-center justify-between z-50">
                            <div className="flex items-center gap-2 overflow-hidden">
                                {view === "editor" && <button onClick={() => setView("dashboard")} className="p-1.5 bg-gray-100 dark:bg-slate-800 rounded-full"><Icons.Back /></button>}
                                <h1 className="font-bold truncate text-sm">{view === "editor" ? editor.name : "GAS Mobile"}</h1>
                            </div>
                            <button onClick={toggleTheme} className="p-2 rounded-full text-lg">ðŸŒ—</button>
                        </div>
                    )}

                    {/* Views */}
                    <div className="p-0 flex-1 relative overflow-hidden flex flex-col h-full">
                        
                        {/* LOADING */}
                        {loading && (
                            <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[100] flex flex-col items-center justify-center">
                                <div className="loader mb-4"></div>
                                <div className="text-white font-medium text-lg animate-pulse">Processing...</div>
                            </div>
                        )}

                        {/* LOGIN */}
                        {view === "login" && (
                            <div className="flex flex-col items-center justify-center h-full p-6 space-y-4">
                                <h1 className="text-2xl font-bold">Locked</h1>
                                <input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder="API Secret" className="w-full max-w-xs bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded p-3 text-center" />
                                <button onClick={handleLogin} className="w-full max-w-xs bg-blue-600 text-white font-bold py-3 rounded-xl">Unlock</button>
                            </div>
                        )}

                        {/* DASHBOARD */}
                        {view === "dashboard" && (
                            <div className="flex flex-col h-full">
                                <div className="flex items-center gap-2 p-3 overflow-x-auto border-b border-gray-100 dark:border-slate-800">
                                    <button onClick={() => setModal({ type: 'create' })} className="px-3 py-1.5 rounded-full text-sm font-bold border-2 border-emerald-500 text-emerald-500 flex items-center gap-1 active:bg-emerald-50"><Icons.Plus /> New</button>
                                    <FilterChip label="Scripts" id="script" />
                                    <FilterChip label="Sheets" id="sheet" />
                                    <FilterChip label="Docs" id="doc" />
                                    <FilterChip label="Forms" id="form" />
                                </div>
                                <div className="flex-1 overflow-y-auto p-3 space-y-3 pb-20">
                                    {projects.map(p => (
                                        <div key={p.id} className="bg-white dark:bg-slate-800 rounded-lg border border-gray-200 dark:border-slate-700 overflow-hidden shadow-sm flex flex-col">
                                            <div onClick={() => openProject(p)} className="p-4 flex items-center gap-3 active:bg-gray-50 dark:active:bg-slate-700 cursor-pointer">
                                                {p.mime.includes('sheet') ? <Icons.Sheet /> : p.mime.includes('doc') ? <Icons.Doc /> : p.mime.includes('form') ? <Icons.Form /> : <Icons.Script />}
                                                <div className="flex-1 min-w-0">
                                                    <h3 className="font-semibold truncate">{p.name}</h3>
                                                    <p className="text-xs text-gray-400">{p.updated}</p>
                                                </div>
                                            </div>
                                            <div className="flex border-t border-gray-100 dark:border-slate-700 divide-x divide-gray-100 dark:divide-slate-700">
                                                {(p.mime.includes('script') || p.linkedScriptId) && <>
                                                    <button onClick={(e) => { e.stopPropagation(); openProject(p).then(() => setModal({ type: 'deploy' })); }} className="flex-1 w-0 p-3 flex justify-center text-yellow-500 active:bg-gray-100"><Icons.Zap /></button>
                                                    <button onClick={(e) => handleLaunch(p, e)} className="flex-1 w-0 p-3 flex justify-center text-blue-500 active:bg-gray-100"><Icons.Globe /></button>
                                                </>}
                                                <button onClick={(e) => handleDelete(p, e)} className="flex-1 w-0 p-3 flex justify-center text-red-500 active:bg-gray-100"><Icons.Trash /></button>
                                            </div>
                                        </div>
                                    ))}
                                    {projects.length === 0 && !loading && <div className="text-center text-gray-400 py-10">No projects</div>}
                                </div>
                            </div>
                        )}

                        {/* EDITOR */}
                        {view === "editor" && (
                            <div className="flex flex-col h-full relative">
                                {/* FILE TABS WITH DELETE ICON */}
                                <div className="flex overflow-x-auto border-b border-gray-200 dark:border-slate-800 bg-gray-50 dark:bg-slate-900">
                                    {editor.files.map((f, i) => (
                                        <button key={i} onClick={() => setEditor({...editor, activeIdx: i})} className={`px-4 py-3 text-sm font-mono border-b-2 transition flex items-center gap-2 ${i === editor.activeIdx ? 'border-blue-500 text-blue-600 dark:text-blue-400 bg-white dark:bg-slate-800' : 'border-transparent text-gray-500'}`}>
                                            {f.name}
                                            {i === editor.activeIdx && (
                                                <span onClick={(e) => handleFileDelete(e, i)} className="ml-1 p-1 bg-red-100 dark:bg-red-900/30 text-red-500 rounded-full hover:bg-red-200 dark:hover:bg-red-900/50">
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-3 h-3"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                                </span>
                                            )}
                                        </button>
                                    ))}
                                    <button onClick={() => setModal({type:'addFile'})} className="px-4 py-3 text-sm font-bold text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-slate-800 border-b-2 border-transparent flex items-center gap-1">
                                        <Icons.Plus /> File
                                    </button>
                                </div>
                                <textarea 
                                    className="flex-1 p-4 bg-white dark:bg-slate-900 text-sm font-mono outline-none resize-none pb-24" 
                                    value={editor.files[editor.activeIdx]?.source || ''}
                                    onChange={(e) => {
                                        const newFiles = [...editor.files];
                                        newFiles[editor.activeIdx].source = e.target.value;
                                        setEditor({ ...editor, files: newFiles, isDirty: true });
                                    }}
                                    spellCheck="false"
                                />

                                {/* BOTTOM TOOLBAR */}
                                <div className="fixed bottom-0 left-0 w-full bg-white dark:bg-slate-900 border-t border-gray-200 dark:border-slate-800 p-2 pb-safe-b flex items-center gap-2 z-50 shadow-lg">
                                    <button onClick={handlePaste} className="p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg active:scale-90 transition"><Icons.Paste /></button>
                                    <button onClick={handleCopy} className="p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg active:scale-90 transition"><Icons.Copy /></button>
                                    
                                    <input 
                                        type="text" 
                                        value={deployDesc}
                                        onChange={(e) => setDeployDesc(e.target.value)}
                                        className="flex-1 bg-gray-100 dark:bg-slate-800 border-0 rounded-lg px-3 py-2 outline-none text-sm"
                                        placeholder="Version Desc"
                                    />
                                    
                                    <button onClick={saveFile} className="p-2 bg-green-600 text-white rounded-lg shadow-md active:scale-90 transition"><Icons.Save /></button>
                                    <button onClick={() => setModal({type:'deploy', desc: deployDesc})} className="p-2 text-yellow-600 dark:text-yellow-500 hover:bg-yellow-50 dark:hover:bg-yellow-900/20 rounded-lg active:scale-90 transition"><Icons.Zap /></button>
                                </div>
                            </div>
                        )}

                        {/* MODALS */}
                        {modal && (
                            <div className="modal-bg" onClick={() => setModal(null)}>
                                <div className="bg-white dark:bg-slate-800 p-5 rounded-2xl w-10/12 max-w-sm shadow-2xl space-y-4" onClick={e => e.stopPropagation()}>
                                    
                                    {modal.type === 'create' && <><h3 className="font-bold text-lg">New Project</h3><input autoFocus placeholder="Project Name" className="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded-lg p-3 outline-none" id="create-input" /><div className="flex gap-2"><button onClick={() => setModal(null)} className="flex-1 p-3 bg-gray-100 dark:bg-slate-700 rounded-lg font-bold">Cancel</button><button onClick={() => { const n = document.getElementById('create-input').value; if(n) { setModal(null); setLoading(true); api('createProject', {title:n}).then(() => { loadProjects(); toast("Created"); }).catch(e=>toast(e.message)).finally(()=>setLoading(false)); } }} className="flex-1 p-3 bg-blue-600 text-white rounded-lg font-bold">Create</button></div></>}
                                    
                                    {modal.type === 'link' && <><h3 className="font-bold text-lg">Link Script</h3><p className="text-xs text-gray-500">Paste the Script ID found in the URL.</p><input autoFocus placeholder="Script ID" className="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded-lg p-3 outline-none" id="link-input" /><button onClick={() => { const id = document.getElementById('link-input').value; if(id) { setModal(null); setLoading(true); api('linkScript', {containerId: modal.data.containerId, scriptId: id}).then(() => { loadProjects(); toast("Linked"); }).finally(()=>setLoading(false)); } }} className="w-full p-3 bg-blue-600 text-white rounded-lg font-bold">Link</button></>}
                                    
                                    {modal.type === 'addFile' && <><h3 className="font-bold text-lg">Add File</h3><input autoFocus placeholder="Filename (no ext)" className="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded-lg p-3 outline-none" id="file-input" /><div className="flex gap-2"><button onClick={() => { const n = document.getElementById('file-input').value; if(n) { setEditor(prev => ({...prev, files: [...prev.files, {name: n, type: 'SERVER_JS', source: ''}], activeIdx: prev.files.length})); setModal(null); } }} className="flex-1 p-3 bg-blue-100 text-blue-700 rounded-lg font-bold">Script</button><button onClick={() => { const n = document.getElementById('file-input').value; if(n) { setEditor(prev => ({...prev, files: [...prev.files, {name: n, type: 'HTML', source: '<html></html>'}], activeIdx: prev.files.length})); setModal(null); } }} className="flex-1 p-3 bg-orange-100 text-orange-700 rounded-lg font-bold">HTML</button></div></>}
                                    
                                    {modal.type === 'deploy' && <>
                                        <h3 className="font-bold text-lg">Deploy</h3>
                                        <input 
                                            placeholder="Description (e.g. v2)" 
                                            className="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded-lg p-3 outline-none" 
                                            value={modal.desc || deployDesc}
                                            onChange={(e) => { setDeployDesc(e.target.value); setModal(prev=>({...prev, desc: e.target.value})); }}
                                            id="deploy-desc" 
                                        />
                                        <select id="deploy-access" className="w-full bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded-lg p-3 outline-none"><option value="ANYONE">Anyone (Anonymous)</option><option value="GOOGLE">Anyone with Google</option><option value="MYSELF">Only Me</option></select>
                                        <div className="flex gap-2">
                                            <button onClick={() => executeDeploy(true, document.getElementById('deploy-access').value, document.getElementById('deploy-desc').value)} className="flex-1 p-3 bg-blue-600 text-white rounded-lg font-bold">New</button>
                                            <button onClick={() => executeDeploy(false, document.getElementById('deploy-access').value, document.getElementById('deploy-desc').value)} className="flex-1 p-3 bg-emerald-600 text-white rounded-lg font-bold">Update</button>
                                        </div>
                                    </>}

                                    {modal.type === 'pasteManual' && <><h3 className="font-bold">Paste</h3><p className="text-xs">Browser blocked auto-paste. Paste manually below:</p><textarea id="manual-paste-area" className="w-full h-32 bg-gray-50 dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded-lg p-2"></textarea><button onClick={() => { const t = document.getElementById('manual-paste-area').value; if(t) { const n=[...editor.files]; n[editor.activeIdx].source=t; setEditor({...editor, files:n, isDirty:true}); toast("Pasted"); } setModal(null); }} className="w-full p-3 bg-blue-600 text-white rounded-lg font-bold">Confirm</button></>}
                                </div>
                            </div>
                        )}
                        <div className={`toast ${toastMsg ? 'show' : ''}`}>{toastMsg}</div>
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
